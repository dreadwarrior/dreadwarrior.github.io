{{ define "main" }}

<main>
    <div class="content">
        <h1>{{ with .Params.Title }}{{ . }}{{ else }}{{ .Section | title }} - {{ .Data.Term | title }}{{ end }}</h1>
    </div>

    <div class="pure-g">
        <div class="pure-u-1 pure-u-lg-8-24">
            <div class="content-padded">
                {{ .Content }}
            </div>
        </div>
        <div class="term-list-u pure-u-1 pure-u-lg-16-24">
            <div class="content-padded">
                {{- $topics := slice -}}
                {{ range .Pages }}
                {{ $topics = $topics | append .Params.topics }}
                {{ end }}

                <div class="control-group awesomplete-combo-group">
                    <input
                            placeholder="Thema filtern"
                            aria-label="Thema filtern"
                            list="topics"
                            data-maxitems="{{ $topics | len }}">
                    <button class="button-trigger"><i class="fas fa-filter fa-xs"></i></button>
                    <button class="button-clear"><i class="fas fa-times fa-xs"></i></button>
                    <datalist id="topics">
                        {{- range ($topics | uniq | sort) }}
                        <option value="{{ . | anchorize }}">{{ . }}</option>
                        {{- end }}
                    </datalist>
                </div>

                <hr class="ruler-decorated">

                <div class="pure-g cover-g">
                    {{ $books := slice }}
                    {{ if eq .Data.Term "completed" }}
                    {{ $books = .Pages.ByDate.Reverse }}
                    {{ else }}
                    {{ $books = .Pages.ByTitle }}
                    {{ end }}
                    {{ range $n, $book := $books }}
                    <a
                            class="cover-u pure-u-1-2 pure-u-md-1-4"
                            aria-labelledby="cover-label-{{ $book.Params.idn }}"
                            href="{{ $book.Permalink }}"
                            data-topics="{{ range $book.Params.topics }}{{ . | anchorize }} {{end }}">
                        <figure class="cover-figure">
                            {{- with partial "book/cover" (dict "isbn" $book.Params.isbn "coverUri"
                            $book.Params.coverUri "coversPath" $.Site.Params.books.coversPath) -}}
                            <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" {{ if gt $n 15 }}
                                 loading="lazy" {{ end }}>
                            {{- end -}}
                            <figcaption id="cover-label-{{ .Params.idn }}">{{ .Title }} - <em>{{ .Params.author }}</em>
                            </figcaption>
                        </figure>
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</main>

{{ $mainJs := resources.Get "js/book-topic-filter.js" | js.Build "book-topic-filter.js" | minify | fingerprint }}
<script src="{{ $mainJs.RelPermalink }}"></script>

{{ end }}